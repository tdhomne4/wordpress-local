jQuery(document).ready((function(e){"use strict";var t=e('.ywccl[data-type="colorpicker"]'),i=e('.ywccl[data-type="image"]'),a=function(t){t.each((function(){e(this).wpColorPicker(),e(this).hasClass("hidden_empty")&&!e(this).val()&&e(this).closest(".wp-picker-container").hide()}))},o=function(t){t.each((function(){var t=e("<input type='button' name='' id='term_value_button' class='button' value='Upload' />");t.insertAfter(this),t.on("click",(function(t){t.preventDefault();var i,a=e(this).attr("id").replace("_button","");if(i)i.open();else{var o=[new wp.media.controller.Library({library:wp.media.query(),multiple:!1,title:"Choose Image",priority:20,filterable:"uploaded"})];(i=wp.media.frames.downloadable_file=wp.media({title:"Choose Image",library:{type:""},button:{text:"Choose Image"},multiple:!1,states:o})).on("select",(function(){var t=i.state().get("selection").first().toJSON();e("#"+a).val(t.url)})),i.open()}}))}))};a(t),o(i);var n=e(".product_page_product_attributes .woocommerce form");"undefined"!=typeof yith_wccl_admin&&yith_wccl_admin.html&&n.find(".form-field").last().after(yith_wccl_admin.html);var l=e(".product_attributes"),r=e("#yith_wccl_dialog_form"),c=r.find(".dialog_error"),d=r.find("form").clone();l.on("click","button.yith_wccl_add_new_attribute",(function(t){t.preventDefault();var i=e(this).closest(".woocommerce_attribute"),n=i.data("taxonomy"),l=e(this).data("type_input"),c=r.find("form"),u=c.find("#term_value, #term_value_2");return u.attr("data-type",l),"colorpicker"==l?(a(u),s(c.find(".ywccl_add_color_icon"))):(c.find("#term_value_2, .ywccl_add_color_icon, br").remove(),"image"==l&&o(u)),r.dialog({width:350,modal:!0,dialogClass:"yith_wccl_dialog_modal",buttons:{Add:function(){e(document).find("#yith_wccl_dialog_form form").trigger("submit",[i,n])},Cancel:function(){r.dialog("close")}},close:function(){var e;e=d.clone(),r.find("form").replaceWith(e)}}),!1})),e(document).on("submit","#yith_wccl_dialog_form form",(function(t,i,a){t.preventDefault();var o,n=e(this),l=n.serializeArray();return l.push({name:"action",value:"yith_wccl_add_new_attribute"},{name:"taxonomy",value:a}),o=e.param(l),n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.post(yith_wccl_admin.ajaxurl,o,(function(e){n.unblock(),e.error?c.html(e.error):e.value&&(c.html(""),i.find("select.attribute_values").append('<option value="'+e.value+'" selected="selected">'+e.name+"</option>"),i.find("select.attribute_values").change(),r.dialog("close"))})),!1}));var s=function(t){t.off("click").on("click",(function(){var t=e(this),i=t.data("content"),a=e(this).nextAll(".wp-picker-container"),o=a.find(".wp-picker-clear");t.data("content",t.html()),t.html(i),o.click(),a.toggle()}))};s(e(".ywccl_add_color_icon"));var u=function(t){var i=t.find(".yith_wccl_variation_gallery_values"),a=t.find("li.image:not('.add')"),o=[];e.each(a,(function(){o.push(e(this).data("value"))})),i.attr("value",o.join(",")).change()};e(document).on("woocommerce_variations_loaded woocommerce_variations_added",(function(){e(".woocommerce_variation:not('.initialized')").each((function(t,i){var a=e(i).find(".yith-wccl-variation-gallery-wrapper"),o=e(i).find(".form-row-full.options").first();a.insertBefore(o),a.find(".yith-wccl-variation-gallery-images").sortable({items:"li.image:not('.add')",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"yith-wccl-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){u(a)}}),e(this).addClass("initialized")}))})),e(document).on("click",".yith-wccl-variation-gallery-images .remove",(function(t){t.preventDefault();var i=e(this).closest(".yith-wccl-variation-gallery-wrapper");e(this).closest(".image").remove(),u(i)})),e(document).on("click",".add-variation-gallery-image",(function(t){if(t.preventDefault(),"undefined"!=typeof wp){var i=e(this),a=i.closest(".yith-wccl-variation-gallery-wrapper"),o=a.find(".yith-wccl-variation-gallery-images"),n=(i.attr("data-index"),wp.media({title:woocommerce_admin_meta_boxes_variations.i18n_choose_image,button:{text:woocommerce_admin_meta_boxes_variations.i18n_set_image},library:{type:"image"},multiple:!0}));n.on("select",(function(){var e=n.state().get("selection").toJSON().map((function(e){if("image"!==e.type||o.find('[data-value="'+e.id+'"]').length)return"";var t=e.id,i=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;return wp.template("yith-wccl-variation-gallery-image")({id:t,url:i})})).join("");o.find(".image.add").before(e),u(a)})),n.open()}}))}));